---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by Administrator.
--- DateTime: 2018/12/27 10:19
---


--------------------------------------------------------------------------------
----------------------桌子逻辑关于 玩家 的处理----------------------------------
--------------------------------------------------------------------------------



-----判断桌子是有人，还是空桌子
function ByTable:CheckTableEmpty()
    if self.UserSeatArrayNumber >0 then
        return false
    end

    return true -- 空桌子
end

--获取桌子的所有玩家-
--function ByTable:GetUsersSeatInTable()
--    local userList = {}
--    for i=1,BY_TABLE_MAX_PLAYER do
--        if self.UserSeatArray[i] ~= nil then
--            -- 说明有人在座位上
--            table.insert(userList,self.UserSeatArray[i])
--        end
--    end
--    return userList     -- 元素是player对象
--end

-----获取桌子的空座位, 返回座椅的编号，从0开始到tableMax， 如果返回-1说明满了-
function ByTable:GetEmptySeatInTable()
    for i=1,BY_TABLE_MAX_PLAYER do
        if self.UserSeatArray[i] == nil then
            return i        -- 返回当前空着的座位号(1,2,3,4)
        end
    end
    return -1   -- 座位满了
end

----玩家坐到椅子上
function ByTable:PlayerSeat(seatID,player)
    self.UserSeatArray[seatID] = player
    self.UserSeatArrayNumber = self.UserSeatArrayNumber + 1   -- 桌子上玩家数量增加

end
----玩家离开椅子
function ByTable:PlayerStandUp(seatID,player)
    Logger(player.User.UserId.."离开桌子"..player.TableID.."椅子"..player.ChairID)
    local game = GetGameByID(player.GameType)
    SetAllPlayerList(player.User.UserId, nil)         -- 清理掉游戏管理的玩家总列表
    self.UserSeatArray[seatID] = nil                -- 清理掉桌子的玩家列表
    self.UserSeatArrayNumber = self.UserSeatArrayNumber - 1  -- 桌子上玩家数量减少
    player.TableID = TABLE_CHAIR_NOBODY
    player.ChairID = TABLE_CHAIR_NOBODY

    -- 清理掉玩家所有子弹
    self:DelBullets(player.User.UserId)
    --如果是空桌子的话，清理一下桌子
    if self:CheckTableEmpty() then
        self:ClearTable()
        game:ReleaseTableByUID(self.TableID)    --回收桌子
    end
end

-----清理桌子
function ByTable:ClearTable()
    -- 清理一下生成鱼的结构
    self.DistributeArray = {}
    self.BossDistributeArray = {}

    -- 清理掉所有子弹和鱼群
    self:DelBullets(-1)
    self:DelFishes()

    self.BulletArray = {}
    self.FishArray = {}
    self.UserSeatArray = {}     --  seatID    player

end
