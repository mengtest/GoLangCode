---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by soonyo.
--- DateTime: 2019/4/28 14:14
---

----------------------------------------------------------------------------------
---  玩家流水日志
----------------------------------------------------------------------------------


-- 玩家创建自己的流水表
function sqlSaveUserCreateLogTable(UserId)
    local sql = string.format([[
    create table zzlog_user_%s (
    time varchar(20) ,
    main_type varchar(10) ,
    sub_type varchar(10),
    room_score int,
    get_score bigint,
    get_coin int,
    get_lottery int
    );
    ]],  UserId )
    ZMySqlExec(sql)
end



----------------------------保存玩家的流水日志信息， 包含投币，推币，老虎机，翻牌，热血模式，轮盘， 都保存在玩家自己的流水表里面-----------------------------
function SqlSaveUserLog(player,main_type,sub_type, get_coin,get_lottery , RoomScore)
    local gameTable = player:GetTable()
    local room_score = gameTable.RoomScore
    if RoomScore ~= nil then
        room_score = RoomScore      -- 邮件使用，因为邮件没有房间倍率
    end
    local time= GetOsDateNow()
    local sql = string.format("insert into zzlog_user_%s (time,main_type,sub_type,room_score,get_score,get_coin,get_lottery) values ('%s','%s','%s', %d, %d, %d ,%d )",
            player.User.UserId, time, main_type,sub_type,gameTable.RoomScore, room_score * get_coin,get_coin,get_lottery )
    ZMySqlExec(sql) -- 性能快
end

function SqlSaveUserLogBySystem(player, title , get_score, get_lottery)
    local time= GetOsDateNow()
    local sql = string.format("insert into zzlog_user_%s (time,main_type,sub_type,room_score,get_score,get_coin,get_lottery) values ('%s','%s','%s', %d, %d, %d ,%d )",
            player.User.UserId, time, title,"获得",0, get_score , 0 ,get_lottery )
    ZMySqlExec(sql) -- 性能快
end



-- 投币流水日志
function SqlSaveUserCostCoinLog(player,get_coin)
    SqlSaveUserLog(player ,"投币" , "消耗" ,   -get_coin, 0 )
end

-- 推币流水日志
function SqlSaveUserObtainCoinLog(player,get_coin, get_lottery)
    SqlSaveUserLog(player ,"推币" , "收获" ,   get_coin, get_lottery )
end

-- 获取翻牌类型字符串
function GetCardTypeString(sub_type)
    local cardType = ""
    if sub_type == CARD_TYPE_DUIZI then
        cardType = "对子"
    elseif sub_type == CARD_TYPE_DOUBLE_DUIZI then
        cardType = "双对子"
    elseif sub_type == CARD_TYPE_SANTIAO then
        cardType = "三条"
    elseif sub_type == CARD_TYPE_SHUNZI then
        cardType = "顺子"
    elseif sub_type == CARD_TYPE_TONGHUA then
        cardType = "同花"
    elseif sub_type == CARD_TYPE_HULU then
        cardType = "葫芦"
    elseif sub_type == CARD_TYPE_TIEZHI then
        cardType = "铁支"
    elseif sub_type == CARD_TYPE_TONGHUASHUN then
        cardType = "同花顺"
    elseif sub_type == CARD_TYPE_WANG then
        cardType = "王"
    end
    return cardType
end

-- 翻牌流水日志
function SqlSaveUserCardLog(player,sub_type,get_coin,get_lottery)
    local cardType = GetCardTypeString(sub_type)
    SqlSaveUserLog(player ,"翻牌" , cardType ,get_coin,get_lottery)
end


-- 热血模式流水日志
function SqlSaveUserBloodModeLog(player,sub_type,get_coin,get_lottery)
    SqlSaveUserLog(player ,"热血模式" , sub_type, get_coin,get_lottery)
end


-- 获取老虎机类型字符串
function GetTigerTypeString(sub_type)
    local tigerType = ""
    if sub_type == TIGER_TYPE_APPLE then
        tigerType = "苹果"
    elseif sub_type == TIGER_TYPE_ORANGE then
        tigerType = "橙子"
    elseif sub_type == TIGER_TYPE_LEMON_DIMOND then
        tigerType = "柠檬钻石"
    elseif sub_type == TIGER_TYPE_BELL then
        tigerType = "铃铛"
    elseif sub_type == TIGER_TYPE_WATERMELON then
        tigerType = "西瓜"
    elseif sub_type == TIGER_TYPE_STAR_CHERRY then
        tigerType = "星星樱桃"
    elseif sub_type == TIGER_TYPE_7 then
        tigerType = "777"
    elseif sub_type == TIGER_TYPE_BAR then
        tigerType = "bar"
    elseif sub_type == TIGER_TYPE_ROU then
        tigerType = "轮盘"
    end
    return tigerType
end

-- 老虎机流水日志
function SqlSaveUserTigerLog(player,sub_type,get_coin,get_lottery)
    local tigerType = GetTigerTypeString(sub_type)
    SqlSaveUserLog(player ,"老虎机" , tigerType , get_coin,get_lottery)
end


-- 轮盘流水日志
function SqlSaveUserWheelLog(player,sub_type, get_coin,get_lottery)
    SqlSaveUserLog(player ,"轮盘" , sub_type, get_coin,get_lottery)
end

-- 邮件流水日志
function SqlSaveUserGetMailGiftLog(player,get_score,get_lottery )
    SqlSaveUserLogBySystem(player,"邮件",get_score,get_lottery )

end
-- 签到流水日志
function SqlSaveUserGetSignInLog(player,get_score,get_lottery )
    SqlSaveUserLogBySystem(player,"签到",get_score,get_lottery )
end
-- 整点领金币流水日志
function SqlSaveUserGetGoldByClockLog(player,title, get_score )
    SqlSaveUserLogBySystem(player,title,get_score,0)
end
-- vip救济金流水日志
function SqlSaveUserGetGoldByVipLog(player, get_score )
    SqlSaveUserLogBySystem(player,"vip救济金",get_score,0)
end
-- 幸运轮盘抽奖流水日志
function SqlSaveUserGetGoldByLuckyWheelLog(player, get_score )
    SqlSaveUserLogBySystem(player,"幸运轮盘奖券抽奖",get_score,0)
end
